
```Python3




```

# 字典树+位运算
```python3
class Trie:
    def __init__(self):
        self.dct = dict()
        return

    def update(self, num):
        cur = self.dct
        for i in range(20, -1, -1):
            w = 1 if num & (1 << i) else 0
            if w not in cur:
                cur[w] = dict()
            cur = cur[w]
            cur["cnt"] = cur.get("cnt", 0) + 1
        return

    def query(self, num):
        cur = self.dct
        ans = 0
        for i in range(20, -1, -1):
            w = 1 if num & (1 << i) else 0
            if 1-w in cur:
                cur = cur[1-w]
                ans += 1<<i
            else:
                cur = cur[w]
        return ans

    def delete(self, num):
        cur = self.dct
        for i in range(20, -1, -1):
            w = num & (1 << i)
            if cur[w].get("cnt", 0) == 1:
                del cur[w]
                break
            cur = cur[w]
            cur["cnt"] -= 1
        return


class Solution:
    def maxGeneticDifference(self, parents: List[int], queries: List[List[int]]) -> List[int]:
        dct = defaultdict(list)
        degree = defaultdict(int)
        n = len(parents)
        root = -1
        for i in range(n):
            if parents[i] != -1:
                dct[parents[i]].append(i)
                degree[i] += 1
            else:
                root = i

        query = defaultdict(dict)
        for node, val in queries:
            query[node][val] = 1

        trie = Trie()

        def dfs(x):
            trie.update(x)
            for y in query[x]:
                query[x][y] = trie.query(y)
            for z in dct[x]:
                dfs(z)
            trie.delete(x)
            return
        dfs(root)

        return [query[node][val] for node, val in queries]
```
